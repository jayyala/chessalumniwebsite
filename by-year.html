<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>By Year â€” UChicago Chess Alumni</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="page">
    <header>
      <h1>University of Chicago<br>Chess Club Alumni</h1>
      <nav>
        <a href="index.html">Directory</a>
        &nbsp;&nbsp;|&nbsp;&nbsp;
        <a href="by-year.html" class="active">By Year</a>
        &nbsp;&nbsp;|&nbsp;&nbsp;
        <a href="admin.html">Admin</a>
      </nav>
      <hr>
    </header>

    <div id="yearIndex">
      <p class="loading">Loading...</p>
    </div>

    <footer>
      <hr>
      <p class="footer-note">University of Chicago Chess Club Alumni Directory</p>
    </footer>
  </div>

  <script>
    async function load() {
      let alumni;
      try {
        const res = await fetch('/api/alumni');
        alumni = await res.json();
      } catch {
        alumni = [];
      }

      const wrap = document.getElementById('yearIndex');

      if (alumni.length === 0) {
        wrap.innerHTML = '<p class="empty">No alumni on record.</p>';
        return;
      }

      const byYear = {};
      alumni.forEach(a => {
        (byYear[a.graduation_year] = byYear[a.graduation_year] || []).push(a);
      });
      const years = Object.keys(byYear).map(Number).sort((a, b) => b - a);

      let html = '';
      years.forEach(year => {
        html += '<h2>Class of ' + year + '</h2><ul>';
        byYear[year]
          .sort((a, b) => a.name.localeCompare(b.name))
          .forEach(a => {
            html += '<li>' + esc(a.name);
            if (a.email) html += ' &#8212; <a href="mailto:' + esc(a.email) + '">' + esc(a.email) + '</a>';
            if (a.notes) html += ' <span class="note">(' + esc(a.notes) + ')</span>';
            html += '</li>';
          });
        html += '</ul>';
      });

      wrap.innerHTML = html;
    }

    function esc(s) {
      return String(s)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;');
    }

    load();
  </script>
</body>
</html>
